---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Giscus from '../../components/Giscus.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({ params: { slug: post.slug }, props: { post } }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.data.title,
  "datePublished": post.data.date.toISOString(),
  "description": post.data.excerpt,
  "author": { "@type": "Person", "name": "Mustafa Emre", "url": "https://mustafaemre.dev" }
};
---

<Layout title={post.data.title} description={post.data.excerpt} type="article">
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  </Fragment>
  <Header />

  <main class="pt-32 pb-20 px-6 min-h-screen flex flex-col">
    <article class="max-w-2xl mx-auto w-full flex-1">
      <header class="mb-10">
        <time class="text-sm text-slate-500 dark:text-slate-500 font-mono">
          {post.data.date.toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric' })}
        </time>
        <h1 class="text-4xl font-bold text-slate-900 dark:text-white mt-2 mb-4">
          {post.data.title}
        </h1>
        {post.data.tags?.length && (
          <div class="flex flex-wrap gap-2">
            {post.data.tags.map((tag) => (
              <span class="px-3 py-1 rounded-full text-xs font-medium bg-cyan-500/15 dark:bg-cyan-500/20 text-cyan-600 dark:text-cyan-400 border border-cyan-500/30">
                {tag}
              </span>
            ))}
          </div>
        )}
      </header>
      <div class="prose prose-slate dark:prose-invert prose-lg max-w-none prose-headings:text-slate-900 dark:prose-headings:text-white prose-p:text-slate-600 dark:prose-p:text-slate-400 prose-a:text-cyan-600 dark:prose-a:text-cyan-400 prose-strong:text-slate-800 dark:prose-strong:text-slate-200">
        <Content />
      </div>
      <footer class="mt-12 pt-8 border-t border-slate-200 dark:border-slate-800/50">
        <a href="/blog" class="text-cyan-600 dark:text-cyan-400 hover:underline text-sm font-medium">
          ← Tüm yazılar
        </a>
      </footer>

      <Giscus />
    </article>

    <Footer />
  </main>
</Layout>
