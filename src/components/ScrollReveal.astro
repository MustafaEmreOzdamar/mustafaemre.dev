---
interface Props {
  delay?: number;
  class?: string;
}

const { delay = 0, class: className = '' } = Astro.props;
---
<div class={`scroll-reveal opacity-0 translate-y-8 transition-all duration-700 ease-out ${className}`} style={`transition-delay: ${delay}ms`}>
  <slot />
</div>

<script>
  if (!window.__scrollRevealInit) {
    window.__scrollRevealInit = true;
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.remove('opacity-0', 'translate-y-8');
          entry.target.classList.add('opacity-100', 'translate-y-0');
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    const observe = () => document.querySelectorAll('.scroll-reveal').forEach((el) => observer.observe(el));
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', observe);
    else observe();
  }
</script>
